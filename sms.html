<!-- <!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<title>ارسال پیامک</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  body {
    margin: 0;
    font-family: Vazir, sans-serif;
    direction: rtl;
    background: #f5f5f5;
  }
  header {
    background: #fff;
    border-bottom: 1px solid #ddd;
    padding: 15px 16px;
    font-size: 16px;
    font-weight: 600;
    color: #222;
    text-align: center;
  }
  .container {
    max-width: 480px;
    margin: 30px auto;
    background: #fff;
    padding: 20px 25px;
    border: 1px solid #ddd;
    border-radius: 6px;
  }
  h2 {
    margin-bottom: 20px;
    font-size: 18px;
    font-weight: 700;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-size: 13px;
    font-weight: 600;
  }
  input, textarea, select {
    width: 100%;
    padding: 8px 10px;
    font-family: Vazir, sans-serif;
    font-size: 13px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 15px;
  }
  textarea {
    resize: none;
    height: 90px;
  }
  button {
    background: #1976d2;
    color: #fff;
    border: none;
    padding: 11px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
  }
  button:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
  .back-link {
    margin-top: 20px;
    text-align: center;
  }
  .back-link a {
    font-size: 13px;
    color: #1976d2;
    text-decoration: none;
    font-weight: 600;
  }
</style>
</head>

<body>

<header>ارسال پیامک</header>

<div class="container">
  <h2>ارسال پیامک</h2>

  <form id="sendSMSForm" onsubmit="return sendSMS()">

    <label for="receiver">گیرنده</label>
    <select id="receiver">
      <option value="">انتخاب کشاورز</option>
      <option value="09120000001">کشاورز ۱</option>
      <option value="09120000002">کشاورز ۲</option>
      <option value="09120000003">کشاورز ۳</option>
    </select>

    <label for="pattern">کد پترن</label>
    <input type="text" id="pattern" placeholder="مثلاً: 12345" />

    <label for="message">متن پیام</label>
    <textarea id="message" placeholder="متن پیامک..."></textarea>

    <button type="submit" id="sendBtn">✈ ارسال پیامک</button>
  </form>

  <div class="back-link">
    <a href="dashboard.html">⬅ بازگشت به داشبورد</a>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const API = "https://edu-api.havirkesht.ir";
  const token = localStorage.getItem("token");

  if (!token) {
    location.href = "index.html";
    return;
  }

  const form = document.getElementById("sendSMSForm");
  const btn  = document.getElementById("sendBtn");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const receiver = document.getElementById("receiver").value.trim();
    const pattern  = document.getElementById("pattern").value.trim();
    const message  = document.getElementById("message").value.trim();

    if (!receiver || !pattern || !message) {
      Swal.fire("خطا", "لطفاً همه فیلدها را پر کنید", "warning");
      return;
    }

    btn.disabled = true;
    btn.innerHTML = "⏳ در حال ارسال...";

    fetch"https://edu-api.havirkesht.ir/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        receptor: receiver,
        pattern_code: pattern,
        message: message
      })
    })
    .then(res => res.json())
    .then(data => {

      if (data.error) {
        Swal.fire("خطا", data.error, "error");
        btn.disabled = false;
        btn.innerHTML = "✈ ارسال پیامک";
        return;
      }

      Swal.fire({
        icon: "success",
        title: "ارسال شد",
        text: "پیامک با موفقیت ارسال شد ✅",
        confirmButtonText: "باشه"
      });

      form.reset();
      btn.disabled = false;
      btn.innerHTML = "✈ ارسال پیامک";
    })
    .catch(() => {
      Swal.fire("خطا", "خطای ارتباط با سرور", "error");
      btn.disabled = false;
      btn.innerHTML = "✈ ارسال پیامک";
    });
  });

});
</script>
</body>
</html> -->